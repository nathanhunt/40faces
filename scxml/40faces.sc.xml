<scxml
        xmlns="http://www.w3.org/2005/07/scxml"
        version="1.0"
        profile="ecmascript">

    <datamodel>
        <data id="bubbles"/>
        <data id="media"/>
        <data id="blurb"/>
        <data id="duration"/>
        <data id="circle"/>
        <data id="track"/>
        <data id="startPoint"/>
    </datamodel>

    <state id="initial-default">
        <transition event="init" target="loading">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <script>
                bubbles.deploy();
            </script>
        </transition>
    </state>

    <state id="loading">
        <transition event="readyForMain" target="mainView">
            <assign location="media" expr="_event.data.media"/>
            <assign location="blurb" expr="_event.data.blurb"/>
            <script>
                media.load();
            </script>
        </transition>
    </state>

    <state id="mainView">

        <onexit>
            <script>
                media.pause();
                $('#hitAreas').hide();
            </script>
        </onexit>

        <onentry>
            <script>
                $('#hitAreas').show();
            </script>
        </onentry>

        <initial>
            <transition target="general"/>
        </initial>

        <transition event="toAbout" target="aboutView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('about', 'main', duration, 'easeInOut');
                $('#nav-link-list a').not('.about').removeClass('active');
                $('#nav-link-list a.about').addClass('active');
            </script>
        </transition>
        <transition event="toContact" target="contactView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('contact', 'main', duration, 'easeInOut');
                $('#nav-link-list a').not('.contact').removeClass('active');
                $('#nav-link-list a.contact').addClass('active');
            </script>
        </transition>

        <state id="general">
            <transition event="toSpecific" target="loadSpecific">
                <assign location="circle" expr="_event.data.circle"/>
                <assign location="track" expr="_event.data.track"/>
                <assign location="startPoint" expr="_event.data.startPoint"/>
            </transition>
        </state>

        <state id="loadSpecific">
            <onentry>
                <script>
                    media.load(track, startPoint);
                    blurb.display(circle);
                </script>
            </onentry>

            <initial>
                <transition target="stillLoadingAnimating"/>
            </initial>
            <state id="stillLoadingAnimating">
                <transition event="trackLoaded" target="specificStillAnimating"/>
                <transition event="animationComplete" target="stillLoading"/>
            </state>
            <state id="stillLoading">
                <transition event="trackLoaded" target="specificReady"/>
            </state>
        </state>

        <state id="specific">
            <state id="specificStillAnimating">
                <transition event="animationComplete" target="specificReady"/>
            </state>
            <state id="specificReady">
                <transition event="leaveSpecific" target="general"/>
                <transition event="toSpecific" target="loadSpecific">
                    <assign location="circle" expr="_event.data.circle"/>
                    <assign location="track" expr="_event.data.track"/>
                    <assign location="startPoint" expr="_event.data.startPoint"/>
                </transition>
            </state>
        </state>

    </state>

    <state id="aboutView">
        <transition event="toMain" target="mainView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('main', 'about', duration, 'easeInOut');
                $('#nav-link-list a').not('.main').removeClass('active');
                $('#nav-link-list a.main').addClass('active');
            </script>
        </transition>
        <transition event="toContact" target="contactView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('contact', 'about', duration, 'easeInOut');
                $('#nav-link-list a').not('.contact').removeClass('active');
                $('#nav-link-list a.contact').addClass('active');
            </script>
        </transition>
    </state>

    <state id="contactView">
        <transition event="toMain" target="mainView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('main', 'contact', duration, 'easeInOut');
                $('#nav-link-list a').not('.main').removeClass('active');
                $('#nav-link-list a.main').addClass('active');
            </script>
        </transition>
        <transition event="toAbout" target="aboutView">
            <assign location="bubbles" expr="_event.data.bubbles"/>
            <assign location="duration" expr="_event.data.duration"/>
            <script>
                bubbles.transition('about', 'contact', duration, 'easeInOut');
                $('#nav-link-list a').not('.about').removeClass('active');
                $('#nav-link-list a.about').addClass('active');
            </script>
        </transition>
    </state>

</scxml>